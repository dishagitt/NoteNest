<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="font-sans bg-gradient-to-br from-gray-900 via-blue-950 to-gray-900 min-h-screen flex flex-col"
  >
    <!-- Navbar -->
    <nav
      class="bg-gradient-to-r from-cyan-700 to-blue-900 shadow-md flex justify-between items-center px-6 py-3"
    >
      <div class="text-lg font-semibold">Hello, {{fname}}</div>
      <div class="text-2xl font-bold tracking-wide text-cyan-300 mr-16">
        NoteNest
      </div>

      <!-- Profile menu -->
      <div id="profileMenu" class="relative">
        <img
          src="{{ url_for('static', filename='images/user.png') }}"
          alt="Profile"
          class="w-10 h-10 rounded-full border-2 border-white cursor-pointer"
          onclick="toggleDropdown(event)"
        />
        <div
          id="profileDropdown"
          class="absolute right-0 mt-2 w-48 bg-gray-800 text-gray-100 rounded-md shadow-lg hidden z-50"
        >
          <!-- Use type="button" and stop propagation when opening modal, then close dropdown -->
          <button
            type="button"
            onclick="event.stopPropagation(); togglePopup(); document.getElementById('profileDropdown').classList.add('hidden');"
            class="w-full text-left px-4 py-2 hover:bg-cyan-700"
          >
            Change Password
          </button>

          <a
            href="{{ url_for('logout') }}"
            class="block px-4 py-2 hover:bg-cyan-700"
            >Logout</a
          >
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% if message %}
    <p class="msg text-center text-red-500 mt-4">{{ message }}</p>
    {% endif %} {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %} {% for category, message in messages %}
    <div
      class="flash {{ category }} text-center p-2 bg-cyan-600 text-white rounded-md my-2 w-2/3 mx-auto"
    >
      {{ message }}
    </div>
    {% endfor %} {% endif %} {% endwith %}

    <!-- Main Form -->
    <div
      class="main bg-gray-800 text-white p-10 w-full max-w-2xl rounded-2xl shadow-xl mx-auto mt-20 transition transform hover:-translate-y-1 hover:shadow-2xl"
    >
      <h1 class="text-center mb-6 text-3xl font-bold text-cyan-400">
        Edit Note
      </h1>

      {% for item in items %}
      <form
        method="POST"
        action="{{url_for('updateNote', id=item[0])}}"
        class="flex flex-col gap-5"
      >
        <input
          name="title"
          value="{{item[2]}}"
          type="text"
          placeholder="Title"
          required
          class="w-full px-5 py-3 rounded-lg border border-gray-600 bg-gray-900 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"
        />
        <textarea
          name="content"
          required
          class="w-full px-5 py-3 rounded-lg border border-gray-600 bg-gray-900 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 min-h-[150px] resize-y"
        >
{{item[3]}}</textarea
        >

        <div class="btn-group flex gap-5">
          <button
            type="submit"
            class="flex-1 px-6 py-3 rounded-full bg-gradient-to-r from-cyan-600 to-blue-800 text-white font-medium shadow-md hover:from-cyan-700 hover:to-blue-900 transform hover:-translate-y-1 transition"
          >
            Save
          </button>

          <button
            type="button"
            onclick="window.location='{{ url_for('closeEdit') }}'"
            class="flex-1 px-6 py-3 rounded-full bg-gray-400 text-gray-900 font-medium shadow-md hover:bg-gray-500 transform hover:-translate-y-1 transition"
          >
            Close
          </button>
        </div>
      </form>
      {% endfor %}
    </div>

    <!-- Footer -->
    <footer class="bg-blue-950 text-white text-center py-3 mt-auto">
      Â© 2025 Disha Prajapati. All rights reserved.
    </footer>

    <!-- Script for dropdown -->
    <script>
      function toggleDropdown() {
        const dropdown = document.getElementById("dropdownMenu");
        dropdown.classList.toggle("hidden");
      }
      // close dropdown if clicked outside
      window.addEventListener("click", function (e) {
        const menu = document.getElementById("dropdownMenu");
        if (!e.target.closest(".user-menu")) {
          menu.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
